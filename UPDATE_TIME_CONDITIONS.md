# –£—Å–ª–æ–≤–∏—è –≤—ã–≤–æ–¥–∞ –ø–æ–¥—Å–∫–∞–∑–∫–∏ "–û–±–Ω–æ–≤–ª–µ–Ω–æ –¢–æ–ª—å–∫–æ —á—Ç–æ"

## üìç –ú–µ—Å—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

–ü–æ–¥—Å–∫–∞–∑–∫–∞ –æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ **–¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö**:

### 1. –í AppBar (–≤–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å)
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å–ø—Ä–∞–≤–∞ –≤ AppBar, –ø–µ—Ä–µ–¥ –∫–Ω–æ–ø–∫–æ–π –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- **–£—Å–ª–æ–≤–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è**: `state.lastUpdated != null`
- **–§–æ—Ä–º–∞—Ç**: –ø—Ä–æ—Å—Ç–æ –≤—Ä–µ–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–¢–æ–ª—å–∫–æ —á—Ç–æ", "5 –º–∏–Ω –Ω–∞–∑–∞–¥")

### 2. –ù–∞–¥ –ø–µ—Ä–≤–æ–π –∫–∞—Ä—Ç–æ—á–∫–æ–π –≤–∞–ª—é—Ç—ã
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: –Ω–∞–¥ —Å–ø–∏—Å–∫–æ–º –≤–∞–ª—é—Ç, –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤–æ–π –∫–∞—Ä—Ç–æ—á–∫–æ–π
- **–£—Å–ª–æ–≤–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è**: `state.lastUpdated != null` –ò `state.selectedCurrencies.isNotEmpty`
- **–§–æ—Ä–º–∞—Ç**: "–û–±–Ω–æ–≤–ª–µ–Ω–æ: {–≤—Ä–µ–º—è}" (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–û–±–Ω–æ–≤–ª–µ–Ω–æ: –¢–æ–ª—å–∫–æ —á—Ç–æ", "–û–±–Ω–æ–≤–ª–µ–Ω–æ: 5 –º–∏–Ω –Ω–∞–∑–∞–¥")

---

## ‚è∞ –õ–æ–≥–∏–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏

–ú–µ—Ç–æ–¥ `_formatLastUpdated()` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–æ–π —Ç–µ–∫—Å—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–∑–Ω–∏—Ü—ã –º–µ–∂–¥—É —Ç–µ–∫—É—â–∏–º –≤—Ä–µ–º–µ–Ω–µ–º –∏ –≤—Ä–µ–º–µ–Ω–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

### –£—Å–ª–æ–≤–∏—è –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ç–µ–∫—Å—Ç:

#### 1. **"–¢–æ–ª—å–∫–æ —á—Ç–æ"** (justNow)
- **–£—Å–ª–æ–≤–∏–µ**: `difference.inMinutes < 1`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—Ä–æ—à–ª–æ **–º–µ–Ω–µ–µ 1 –º–∏–Ω—É—Ç—ã** —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- **–ü—Ä–∏–º–µ—Ä**: –ö—É—Ä—Å—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã 30 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥ ‚Üí "–¢–æ–ª—å–∫–æ —á—Ç–æ"

#### 2. **"{X} –º–∏–Ω –Ω–∞–∑–∞–¥"** (minutesAgo)
- **–£—Å–ª–æ–≤–∏–µ**: `difference.inMinutes >= 1` –ò `difference.inHours < 1`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—Ä–æ—à–ª–æ **–æ—Ç 1 –º–∏–Ω—É—Ç—ã –¥–æ 59 –º–∏–Ω—É—Ç** —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- **–ü—Ä–∏–º–µ—Ä**: –ö—É—Ä—Å—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã 15 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥ ‚Üí "15 –º–∏–Ω –Ω–∞–∑–∞–¥"

#### 3. **"{X} —á –Ω–∞–∑–∞–¥"** (hoursAgo)
- **–£—Å–ª–æ–≤–∏–µ**: `difference.inHours >= 1` –ò `difference.inDays < 1`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—Ä–æ—à–ª–æ **–æ—Ç 1 —á–∞—Å–∞ –¥–æ 23 —á–∞—Å–æ–≤** —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- **–ü—Ä–∏–º–µ—Ä**: –ö—É—Ä—Å—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã 3 —á–∞—Å–∞ –Ω–∞–∑–∞–¥ ‚Üí "3 —á –Ω–∞–∑–∞–¥"

#### 4. **"dd.MM.yyyy HH:mm"** (–ø–æ–ª–Ω–∞—è –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è)
- **–£—Å–ª–æ–≤–∏–µ**: `difference.inDays >= 1`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—Ä–æ—à–ª–æ **–±–æ–ª–µ–µ 1 –¥–Ω—è** —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- **–ü—Ä–∏–º–µ—Ä**: –ö—É—Ä—Å—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã 2 –¥–Ω—è –Ω–∞–∑–∞–¥ ‚Üí "15.12.2024 14:30"

---

## üîÑ –ö–æ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `lastUpdated`?

–í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (`lastUpdated`) —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–ª—É—á–∞—è—Ö:

### 1. –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –∫—É—Ä—Å–æ–≤ –∏–∑ API
```dart
state = state.copyWith(
  rates: rates,
  lastUpdated: DateTime.now(), // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
  isLoading: false,
);
```

### 2. –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫—É—Ä—Å–æ–≤ –∏–∑ –∫—ç—à–∞ (–æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º)
```dart
state = state.copyWith(
  rates: cachedRates,
  lastUpdated: cachedLastUpdated, // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Ä–µ–º—è –∏–∑ –∫—ç—à–∞
  isLoading: false,
);
```

### 3. –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ï—Å–ª–∏ –µ—Å—Ç—å –∫—ç—à –∫—É—Ä—Å–æ–≤, –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤—Ä–µ–º—è –∏–∑ –∫—ç—à–∞
- –ï—Å–ª–∏ –∫—ç—à–∞ –Ω–µ—Ç, `lastUpdated` –æ—Å—Ç–∞–µ—Ç—Å—è `null` –¥–æ –ø–µ—Ä–≤–æ–π —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏

---

## ‚ùå –ö–æ–≥–¥–∞ –ø–æ–¥—Å–∫–∞–∑–∫–∞ –ù–ï –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è?

–ü–æ–¥—Å–∫–∞–∑–∫–∞ **–Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è**, –µ—Å–ª–∏:

1. **`state.lastUpdated == null`**
   - –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
   - –ö—É—Ä—Å—ã –µ—â–µ –Ω–µ –±—ã–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –Ω–∏ —Ä–∞–∑—É
   - –ö—ç—à –∫—É—Ä—Å–æ–≤ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

2. **–°–ø–∏—Å–æ–∫ –≤–∞–ª—é—Ç –ø—É—Å—Ç** (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏ –Ω–∞–¥ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏)
   - `state.selectedCurrencies.isEmpty`
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–∏–ª –Ω–∏ –æ–¥–Ω–æ–π –≤–∞–ª—é—Ç—ã

---

## üìä –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

| –í—Ä–µ–º—è —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è | –û—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç |
|-------------------|-------------------|
| 0 —Å–µ–∫—É–Ω–¥ - 59 —Å–µ–∫—É–Ω–¥ | "–¢–æ–ª—å–∫–æ —á—Ç–æ" |
| 1 –º–∏–Ω—É—Ç–∞ - 59 –º–∏–Ω—É—Ç | "5 –º–∏–Ω –Ω–∞–∑–∞–¥", "15 –º–∏–Ω –Ω–∞–∑–∞–¥" –∏ —Ç.–¥. |
| 1 —á–∞—Å - 23 —á–∞—Å–∞ | "1 —á –Ω–∞–∑–∞–¥", "3 —á –Ω–∞–∑–∞–¥" –∏ —Ç.–¥. |
| 1 –¥–µ–Ω—å –∏ –±–æ–ª–µ–µ | "15.12.2024 14:30" (–ø–æ–ª–Ω–∞—è –¥–∞—Ç–∞) |

---

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ú–µ—Ç–æ–¥ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```dart
String _formatLastUpdated(BuildContext context, DateTime dateTime) {
  final l10n = AppLocalizations.of(context)!;
  final now = DateTime.now();
  final difference = now.difference(dateTime);

  if (difference.inMinutes < 1) {
    return l10n.justNow; // "–¢–æ–ª—å–∫–æ —á—Ç–æ"
  } else if (difference.inHours < 1) {
    return l10n.minutesAgo(difference.inMinutes); // "{X} –º–∏–Ω –Ω–∞–∑–∞–¥"
  } else if (difference.inDays < 1) {
    return l10n.hoursAgo(difference.inHours); // "{X} —á –Ω–∞–∑–∞–¥"
  } else {
    return DateFormat('dd.MM.yyyy HH:mm').format(dateTime); // –ü–æ–ª–Ω–∞—è –¥–∞—Ç–∞
  }
}
```

### –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è:
- –†—É—Å—Å–∫–∏–π: "–¢–æ–ª—å–∫–æ —á—Ç–æ", "5 –º–∏–Ω –Ω–∞–∑–∞–¥", "3 —á –Ω–∞–∑–∞–¥"
- English: "Just now", "5 min ago", "3 h ago"
- –ò –¥—Ä—É–≥–∏–µ —è–∑—ã–∫–∏ —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–Ω—è—Ç—å, –Ω–∞—Å–∫–æ–ª—å–∫–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç
2. **–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞**: –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
3. **–î–ª—è UX**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç, –∫–æ–≥–¥–∞ –∫—É—Ä—Å—ã –±—ã–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑, —á—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç –¥–æ–≤–µ—Ä–∏–µ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é



